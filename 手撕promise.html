<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

</body>

<script>
    class Promise{
        constructor(executor){
            this.state = 'pending' // 默认状态进行中
            this.value = null //成功后携带的值
            this.reason = null //失败后返回的原因
            this.onFulfilledCbs = []
            this.onRejectedCbs = []

            function resolve(value) {
                if (this.state === 'pending') {
                    this.state = 'fulfilled'
                    this.value = value
                    this.onFulfilledCbs.forEach(item => item(this.value))
                }
            }

            function reject(reason) {
                if (this.state === 'pending') {
                    this.state = 'rejected'
                    this.reason = reason
                    this.onRejectedCbs.forEach(item => item(this.reason))
                }
            };

            then(onFufilled, onRejected) {
                if (this.state === 'fulfilled') {
                    onFufilled(this.value)
                }
                if (this.state === 'rejected') {
                    onRejected(this.reason)
                }
                if (this.state === 'pending') {
                    this.onFulfilledCbs.push(onFufilled)
                    this.onRejectedCbs.push(onRejected)
                }
            }
        }
    }
</script>
</html>